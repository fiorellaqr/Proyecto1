<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <link rel="icon" href="img/Logo.png" />
    <link rel="stylesheet" href="css/carrito.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400&display=swap" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/638ca44e0a.js" crossorigin="anonymous"></script>
    <title>Carrito de compras</title>
</head>

<body>

    <div class="fijar">
        <div class="menu">
            <input type="checkbox" id="btn-menu">
            <label for="btn-menu"><i class="fa-solid fa-bars"></i></label>
            <h1><a href="index.html">MiTienda</a></h1>
            <div class="menu-item">
                <p>
                    <b><a href="index.html">Inicio</a></b>
                </p>
                <p>
                    <b><a href="nosotros.html">Nosotros</a></b>
                </p>
                <div class="item-catalogo">
                    <p><b>Catalogo</b></p>
                    <ul>
                        <li><a href="hombres.html">Varones</a></li>
                        <li><a href="mujeres.html">Damas</a></li>
                        <li><a href="Niños.html">Infantes</a></li>
                    </ul>
                </div>
                <p>
                    <a href="#contactanos"><b>Contactanos</b></a>
                </p>
                <p>
                    <b><a href="Login.html">Login</a></b>
                </p>
                <p>
                    <b><a href="carrito.html"><i class="fa-solid fa-cart-shopping"></i></a></b>
                </p>
            </div>
        </div>
    </div>

    <div style="padding-top: 8%">
        <div class="content row" id="cuerpo">

            <div class="col-8 col-md-7 col-sm-11">
                <ul id="listaCarrito" class="list-group list-group-flush">
                    <!-- <li class="list-group-item">
                        <div class="carro-item ">
                            <div class="imgCarrito  col-4 col-md-3 col-sm-3"><img id="imgCarrito" src="img/mujer1.webp" alt=""></div>
                            <div class="detalles row  col-8  col-md-8 col-sm-9">
                                <h5 id="modeloCard">Pantalón Mujer Lazo</h5>
                                <div class="info row col col-12">
                                    <p class="col col-12" style="color: grey;">Codigo: P001</p>

                                    <div class="col col-4 col-sm-3">
                                        <p >Talla: <span>S</span></p>
                                    </div>
                                    <div class="row col col-5 col-sm-6">
                                        <label class="col col-5" for="inputCant">Cantidad</label>
                                        <div class="col input input-group-sm">
                                        <input type="number" class="form-control col col-3">
                                    </div>
                                    </div>
                                    
                                    <div class="col col-10">
                                        <span id="precioCard" class="precio">S/20.00</span>
                                    </div>
                                    <div class="col col-2">
                                        <i class="fa-solid fa-trash"></i>
                                    </div>
                                </div>


                            </div>
                        </div>

                    </li>
                    <li class="list-group-item">
                        <div class="carro-item ">
                            <div class="imgCarrito  col-4 col-md-3 col-sm-3"><img id="imgCarrito" src="img/mujer1.webp" alt=""></div>
                            <div class="detalles row  col-8  col-md-8 col-sm-9">
                                <h5 id="modeloCard">Pantalón Mujer Lazo</h5>
                                <div class="info row col col-12">
                                    <p class="col col-12" style="color: grey;">Codigo: P001</p>

                                    <div class="col col-4 col-sm-3">
                                        <p >Talla: <span>S</span></p>
                                    </div>
                                    <div class="row col col-5 col-sm-6">
                                        <label class="col col-5" for="inputCant">Cantidad</label>
                                        <div class="col input input-group-sm">
                                        <input type="number" class="form-control col col-3">
                                    </div>
                                    </div>
                                    
                                    <div class="col col-10">
                                        <span id="precioCard" class="precio">S/20.00</span>
                                    </div>
                                    <div class="col col-2">
                                        <i class="fa-solid fa-trash"></i>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="carro-item ">
                            <div class="imgCarrito  col-4 col-md-3 col-sm-3"><img id="imgCarrito" src="img/mujer1.webp" alt=""></div>
                            <div class="detalles row  col-8  col-md-8 col-sm-9">
                                <h5 id="modeloCard">Pantalón Mujer Lazo</h5>
                                <div class="info row col col-12">
                                    <p class="col col-12" style="color: grey;">Codigo: P001</p>

                                    <div class="col col-4 col-sm-3">
                                        <p >Talla: <span>S</span></p>
                                    </div>
                                    <div class="row col col-5 col-sm-6">
                                        <label class="col col-5" for="inputCant">Cantidad</label>
                                        <div class="col input input-group-sm">
                                        <input type="number" class="form-control col col-3">
                                    </div>
                                    </div>
                                    
                                    <div class="col col-10">
                                        <span id="precioCard" class="precio">S/20.00</span>
                                    </div>
                                    <div class="col col-2">
                                        <i class="fa-solid fa-trash"></i>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </li> -->
                </ul>
            </div>

            <div class="col-4 col-md-4 col-sm-11">
                <div class="card">
                    <h5 class="card-header">Resumen de Pago</h5>
                    <div class="card-body row">
                        <div class="col col-6">
                            <p class="card-text">Productos (<span id="cprod"></span>):</p>
                        </div>
                        <div class="col col-6">
                            <p>S/. <span id="subtotal"></span></p>
                        </div>
                        <div class="col col-6">
                            <p class="card-text">Envio:</p>
                        </div>
                        <div class="col col-6">
                            <p>S/. <span id="envio">10.00</span></p>
                        </div>
                        <div class="col col-6">
                            <p class="card-text">Total:</p>
                        </div>
                        <div class="col col-6">
                            <p>S/. <span id="total"></span> </p>
                        </div>
                        
                        <a href="checkout.html" class="btn btn-primary col col-11 mx-auto">Procesar compra</a>
                    </div>
                </div>
            </div>
            <!-- <div class="col-10 col-md10">
                <div class="card vacio">
                    <div class="card-body">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <h1 class="card-title">Tu Carro está vacío</h1>
                        <p class="card-text">Tenemos miles de ofertas y oportunidades únicas, ¿te las vas a perder?</p>

                        <a href="mujeres.html" class="btn btn-primary">Ver el catalogo</a>
                    </div>
                </div>
            </div> -->

        </div>
    </div>

    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/jquery.js"></script>
    <script>



        lista = document.getElementById("lista");
        function listarCarrito() {
            $("#listaCarrito").html("");
            arrayCarrito = JSON.parse(localStorage.getItem("miCarrito"));
            arrayProductos = JSON.parse(localStorage.getItem("lista_prod"));

            var total = 0;
            var subtotal = 0;
            console.log(arrayCarrito);
            if (arrayCarrito == null || arrayCarrito.length==0) {
                console.log("vacio");
                 $("#cuerpo").html(`<div class="col-10 col-md10">
                <div class="card vacio">
                    <div class="card-body">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <h1 class="card-title">Tu Carro está vacío</h1>
                        <p class="card-text">Tenemos miles de ofertas y oportunidades únicas, ¿te las vas a perder?</p>

                        <a href="mujeres.html" class="btn btn-primary">Ver el catalogo</a>
                    </div>
                </div>
            </div>`); 
            } else {
                arrayCarrito.forEach((item, index) => {

                    producto = arrayProductos[item.id - 1];
                    subtotal += producto.precio * item.cantidad;
                    total = subtotal + 10;
                    $("#listaCarrito").append(`<li class="list-group-item">
                        <div class="carro-item ">
                            <div class="imgCarrito  col-4 col-md-3 col-sm-3"><img id="imgCarrito" src="${producto.imagen}" alt=""></div>
                            <div class="detalles row  col-8  col-md-8 col-sm-9">
                                <h5 id="modeloCard">${producto.nombre}</h5>
                                <div class="info row col col-12">
                                    <p class="col col-12" style="color: grey;">Codigo: ${producto.codigo}</p>

                                    <div class="col col-4 col-sm-3">
                                        <p >Talla: <span>${item.talla}</span></p>
                                    </div>
                                    <div class="row col col-5 col-sm-6">
                                        <label class="col col-5" for="inputCant">Cantidad</label>
                                        <div class="col input input-group-sm">
                                        <input type="number" id="cantidad" class="form-control col col-3" onChange="actualizarCantidad(this,${producto.id}) ;calcularTotal()" value="${item.cantidad}" min="1">
                                    </div>
                                    </div>
                                    
                                    <div class="col col-10">
                                        <span id="precioCard" class="precio">S/${producto.precio.toFixed(2)}</span>
                                    </div>
                                    <div class="col col-2" data-item="${index}"  onclick="eliminarProducto(this,${item.id})"  >
                                        <i class="fa-solid fa-trash"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                `)
                });
                $("#subtotal").text(subtotal.toFixed(2));
                $("#total").text(total.toFixed(2));
                $("#cprod").text(arrayCarrito.length);

            }
        }

        function calcularTotal() {

            var total = 0;
            var subtotal = 0;

            arrayProductos = JSON.parse(localStorage.getItem("lista_prod"));
            arrayCarrito = JSON.parse(localStorage.getItem("miCarrito"));

            arrayCarrito.forEach((item, index) => {
                var cant = item.cantidad;
                producto = arrayProductos[item.id - 1];
                subtotal += producto.precio * cant;
                total = subtotal + 10;

            })

            $("#subtotal").text(subtotal.toFixed(2));
            $("#total").text(total);


        };

        function actualizarCantidad(obj, idProd) {

            for (let i = 0; i < arrayCarrito.length; i++) {
                if (arrayCarrito[i].id == idProd) {
                    arrayCarrito[i].cantidad = obj.value;
                    break;
                }

            }

            localStorage.setItem("miCarrito", JSON.stringify(arrayCarrito));
        }

        function eliminarProducto(obj, id) {
            let carrito_aux = [];


            arrayCarrito.forEach((elem, index) => {
                if (elem.id != id) {
                    carrito_aux.push(elem);
                }
            });





            localStorage.setItem("miCarrito", JSON.stringify(carrito_aux));
            listarCarrito();
        }

        listarCarrito();
    </script>
</body>

</html>